'use strict';

const kDone = Symbol('kDone');
const kRun = Symbol('kRun');

/**
 * A very simple job queue with adjustable concurrency. Adapted from
 * https://github.com/STRML/async-limiter
 */
class Limiter ***REMOVED***
  /**
   * Creates a new `Limiter`.
   *
   * @param ***REMOVED***Number***REMOVED*** [concurrency=Infinity] The maximum number of jobs allowed
   *     to run concurrently
   */
  constructor(concurrency) ***REMOVED***
    this[kDone] = () => ***REMOVED***
      this.pending--;
      this[kRun]();
    ***REMOVED***;
    this.concurrency = concurrency || Infinity;
    this.jobs = [];
    this.pending = 0;
  ***REMOVED***

  /**
   * Adds a job to the queue.
   *
   * @param ***REMOVED***Function***REMOVED*** job The job to run
   * @public
   */
  add(job) ***REMOVED***
    this.jobs.push(job);
    this[kRun]();
  ***REMOVED***

  /**
   * Removes a job from the queue and runs it if possible.
   *
   * @private
   */
  [kRun]() ***REMOVED***
    if (this.pending === this.concurrency) return;

    if (this.jobs.length) ***REMOVED***
      const job = this.jobs.shift();

      this.pending++;
      job(this[kDone]);
    ***REMOVED***
  ***REMOVED***
***REMOVED***

module.exports = Limiter;
