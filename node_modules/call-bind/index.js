'use strict';

var bind = require('function-bind');
var GetIntrinsic = require('get-intrinsic');

var $apply = GetIntrinsic('%Function.prototype.apply%');
var $call = GetIntrinsic('%Function.prototype.call%');
var $reflectApply = GetIntrinsic('%Reflect.apply%', true) || bind.call($call, $apply);

var $gOPD = GetIntrinsic('%Object.getOwnPropertyDescriptor%', true);
var $defineProperty = GetIntrinsic('%Object.defineProperty%', true);
var $max = GetIntrinsic('%Math.max%');

if ($defineProperty) ***REMOVED***
	try ***REMOVED***
		$defineProperty(***REMOVED******REMOVED***, 'a', ***REMOVED*** value: 1 ***REMOVED***);
	***REMOVED*** catch (e) ***REMOVED***
		// IE 8 has a broken defineProperty
		$defineProperty = null;
	***REMOVED***
***REMOVED***

module.exports = function callBind(originalFunction) ***REMOVED***
	var func = $reflectApply(bind, $call, arguments);
	if ($gOPD && $defineProperty) ***REMOVED***
		var desc = $gOPD(func, 'length');
		if (desc.configurable) ***REMOVED***
			// original length, plus the receiver, minus any additional arguments (after the receiver)
			$defineProperty(
				func,
				'length',
				***REMOVED*** value: 1 + $max(0, originalFunction.length - (arguments.length - 1)) ***REMOVED***
			);
		***REMOVED***
	***REMOVED***
	return func;
***REMOVED***;

var applyBind = function applyBind() ***REMOVED***
	return $reflectApply(bind, $apply, arguments);
***REMOVED***;

if ($defineProperty) ***REMOVED***
	$defineProperty(module.exports, 'apply', ***REMOVED*** value: applyBind ***REMOVED***);
***REMOVED*** else ***REMOVED***
	module.exports.apply = applyBind;
***REMOVED***
