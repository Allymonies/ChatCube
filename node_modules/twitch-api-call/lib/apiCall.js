"use strict";
/// <reference lib="dom" />
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true ***REMOVED***);
exports.callTwitchApi = exports.callTwitchApiRaw = void 0;
var tslib_1 = require("tslib");
var cross_fetch_1 = require("@d-fischer/cross-fetch");
var qs_1 = require("@d-fischer/qs");
var transform_1 = require("./helpers/transform");
var url_1 = require("./helpers/url");
var TwitchApiCallOptions_1 = require("./TwitchApiCallOptions");
/**
 * Makes a call to the Twitch API using the given credentials, returning the raw Response object.
 *
 * @param options
 * @param clientId
 * @param accessToken
 * @param fetchOptions
 */
function callTwitchApiRaw(options, clientId, accessToken, fetchOptions) ***REMOVED***
    var _a;
    if (fetchOptions === void 0) ***REMOVED*** fetchOptions = ***REMOVED******REMOVED***; ***REMOVED***
    return tslib_1.__awaiter(this, void 0, void 0, function () ***REMOVED***
        var type, url, params, headers, body, requestOptions;
        return tslib_1.__generator(this, function (_b) ***REMOVED***
            type = options.type === undefined ? TwitchApiCallOptions_1.TwitchApiCallType.Kraken : options.type;
            url = url_1.getTwitchApiUrl(options.url, type);
            params = qs_1.stringify(options.query, ***REMOVED*** arrayFormat: 'repeat' ***REMOVED***);
            headers = new cross_fetch_1.Headers(***REMOVED***
                Accept: type === TwitchApiCallOptions_1.TwitchApiCallType.Kraken ? 'application/vnd.twitchtv.v5+json' : 'application/json'
            ***REMOVED***);
            body = undefined;
            if (options.body) ***REMOVED***
                body = qs_1.stringify(options.body);
                headers.append('Content-Type', 'application/x-www-form-urlencoded');
            ***REMOVED***
            else if (options.jsonBody) ***REMOVED***
                body = JSON.stringify(options.jsonBody);
                headers.append('Content-Type', 'application/json');
            ***REMOVED***
            if (clientId && type !== TwitchApiCallOptions_1.TwitchApiCallType.Auth) ***REMOVED***
                headers.append('Client-ID', clientId);
            ***REMOVED***
            if (accessToken) ***REMOVED***
                headers.append('Authorization', (type === TwitchApiCallOptions_1.TwitchApiCallType.Helix ? 'Bearer' : 'OAuth') + " " + accessToken);
            ***REMOVED***
            requestOptions = tslib_1.__assign(tslib_1.__assign(***REMOVED******REMOVED***, fetchOptions), ***REMOVED*** method: (_a = options.method) !== null && _a !== void 0 ? _a : 'GET', headers: headers,
                body: body ***REMOVED***);
            return [2 /*return*/, cross_fetch_1.default(params ? url + "?" + params : url, requestOptions)];
        ***REMOVED***);
    ***REMOVED***);
***REMOVED***
exports.callTwitchApiRaw = callTwitchApiRaw;
/**
 * Makes a call to the Twitch API using given credentials.
 *
 * @param options The configuration of the call.
 * @param clientId The client ID of your application.
 * @param accessToken The access token to call the API with.
 *
 * You need to obtain one using one of the [Twitch OAuth flows](https://dev.twitch.tv/docs/authentication/getting-tokens-oauth/).
 * @param fetchOptions Additional options to be passed to the `fetch` function.
 */
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function callTwitchApi(options, clientId, accessToken, fetchOptions) ***REMOVED***
    if (fetchOptions === void 0) ***REMOVED*** fetchOptions = ***REMOVED******REMOVED***; ***REMOVED***
    return tslib_1.__awaiter(this, void 0, void 0, function () ***REMOVED***
        var response;
        return tslib_1.__generator(this, function (_a) ***REMOVED***
            switch (_a.label) ***REMOVED***
                case 0: return [4 /*yield*/, callTwitchApiRaw(options, clientId, accessToken, fetchOptions)];
                case 1:
                    response = _a.sent();
                    return [2 /*return*/, transform_1.transformTwitchApiResponse(response)];
            ***REMOVED***
        ***REMOVED***);
    ***REMOVED***);
***REMOVED***
exports.callTwitchApi = callTwitchApi;
