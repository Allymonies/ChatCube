"use strict";
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true ***REMOVED***);
exports.AbstractConnection = void 0;
var tslib_1 = require("tslib");
var typed_event_emitter_1 = require("@d-fischer/typed-event-emitter");
var AbstractConnection = /** @class */ (function (_super) ***REMOVED***
    tslib_1.__extends(AbstractConnection, _super);
    function AbstractConnection(_a, logger, additionalOptions) ***REMOVED***
        var hostName = _a.hostName, port = _a.port, secure = _a.secure, lineBased = _a.lineBased;
        var _this = _super.call(this) || this;
        _this._currentLine = '';
        _this._connecting = false;
        _this._connected = false;
        _this._manualDisconnect = false;
        _this.onReceive = _this.registerEvent();
        _this.onConnect = _this.registerEvent();
        _this.onDisconnect = _this.registerEvent();
        _this.onEnd = _this.registerEvent();
        _this._host = hostName;
        _this._port = port;
        _this._secure = secure !== null && secure !== void 0 ? secure : true;
        _this._lineBased = lineBased !== null && lineBased !== void 0 ? lineBased : false;
        _this._logger = logger;
        _this._additionalOptions = additionalOptions;
        return _this;
    ***REMOVED***
    Object.defineProperty(AbstractConnection.prototype, "isConnecting", ***REMOVED***
        get: function () ***REMOVED***
            return this._connecting;
    ***REMOVED***
        enumerable: false,
        configurable: true
    ***REMOVED***);
    Object.defineProperty(AbstractConnection.prototype, "isConnected", ***REMOVED***
        get: function () ***REMOVED***
            return this._connected;
    ***REMOVED***
        enumerable: false,
        configurable: true
    ***REMOVED***);
    Object.defineProperty(AbstractConnection.prototype, "host", ***REMOVED***
        get: function () ***REMOVED***
            return this._host;
    ***REMOVED***
        enumerable: false,
        configurable: true
    ***REMOVED***);
    AbstractConnection.prototype.sendLine = function (line) ***REMOVED***
        if (this._connected) ***REMOVED***
            line = line.replace(/[\0\r\n]/g, '');
            this.sendRaw(line + "\r\n");
        ***REMOVED***
    ***REMOVED***;
    AbstractConnection.prototype.assumeExternalDisconnect = function () ***REMOVED***
        var _a;
        (_a = this._logger) === null || _a === void 0 ? void 0 : _a.trace('AbstrctConnection assumeExternalDisconnect');
        this._connected = false;
        this._connecting = false;
        this.emit(this.onDisconnect, false);
    ***REMOVED***;
    AbstractConnection.prototype.receiveRaw = function (data) ***REMOVED***
        var _a, _b;
        if (!this._lineBased) ***REMOVED***
            this.emit(this.onReceive, data);
            return;
        ***REMOVED***
        var receivedLines = data.split('\r\n');
        this._currentLine += (_a = receivedLines.shift()) !== null && _a !== void 0 ? _a : '';
        if (receivedLines.length) ***REMOVED***
            this.emit(this.onReceive, this._currentLine);
            this._currentLine = (_b = receivedLines.pop()) !== null && _b !== void 0 ? _b : '';
            for (var _i = 0, receivedLines_1 = receivedLines; _i < receivedLines_1.length; _i++) ***REMOVED***
                var line = receivedLines_1[_i];
                this.emit(this.onReceive, line);
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***;
    return AbstractConnection;
***REMOVED***(typed_event_emitter_1.EventEmitter));
exports.AbstractConnection = AbstractConnection;
//# sourceMappingURL=AbstractConnection.js.map