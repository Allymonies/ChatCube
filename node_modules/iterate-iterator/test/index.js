'use strict';

var test = require('tape');
var forEach = require('for-each');
var debug = require('object-inspect');
var getIterator = require('es-get-iterator');
var iterate = require('..');

var canDistinguishSparseFromUndefined = 0 in [undefined]; // IE 6 - 8 have a bug where this returns false

function testIteration(t, iterable, expected, message) ***REMOVED***
	t.deepEqual(iterate(getIterator(iterable)), expected, 'no callback: ' + message);
	var values = [];
	iterate(getIterator(iterable), function (x) ***REMOVED*** values.push(x); ***REMOVED***);
	t.deepEqual(values, expected, 'callback: ' + message);
	return values;
***REMOVED***

function getArguments() ***REMOVED***
	return arguments;
***REMOVED***

test('strings', function (t) ***REMOVED***
	testIteration(t, '', [], 'empty string');
	testIteration(t, 'abc', ['a', 'b', 'c'], debug('abc'));
	testIteration(t, 'aðŸ’©c', ['a', 'ðŸ’©', 'c'], debug('aðŸ’©c'));

	t.end();
***REMOVED***);

test('arrays', function (t) ***REMOVED***
	forEach([
		[],
		[1, 2, 3]
	], function (arr) ***REMOVED***
		testIteration(t, arr, arr, debug(arr));
	***REMOVED***);
	t.test('sparse arrays', ***REMOVED*** skip: !canDistinguishSparseFromUndefined ***REMOVED***, function (st) ***REMOVED***
		var sparse = [1, , 3]; // eslint-disable-line no-sparse-arrays
		var actual = testIteration(st, sparse, [1, undefined, 3], debug(sparse));
		st.ok(1 in actual, 'actual is not sparse');
		st.end();
	***REMOVED***);

	t.end();
***REMOVED***);

test('arguments', function (t) ***REMOVED***
	var empty = getArguments();
	testIteration(t, empty, [], debug(empty));

	var args = getArguments(1, 2, 3);
	testIteration(t, args, [1, 2, 3], debug(args));

	t.end();
***REMOVED***);

test('Maps', ***REMOVED*** skip: typeof Map !== 'function' ***REMOVED***, function (t) ***REMOVED***
	var empty = new Map();
	testIteration(t, empty, [], debug(empty));

	var m = new Map();
	m.set(1, 2);
	m.set(3, 4);
	testIteration(t, m, [[1, 2], [3, 4]], debug(m));

	t.end();
***REMOVED***);

test('Sets', ***REMOVED*** skip: typeof Set !== 'function' ***REMOVED***, function (t) ***REMOVED***
	var empty = new Set();
	testIteration(t, empty, [], debug(empty));

	var s = new Set();
	s.add(1);
	s.add(2);
	testIteration(t, s, [1, 2], debug(s));

	t.end();
***REMOVED***);

test('non-function callbacks', function (t) ***REMOVED***
	forEach([
		null,
		undefined,
		false,
		true,
		0,
		-0,
		NaN,
		42,
		Infinity,
		'',
		'abc',
		/a/g,
		[],
		***REMOVED******REMOVED***
	], function (nonFunction) ***REMOVED***
		t['throws'](
			function () ***REMOVED*** iterate(getIterator([]), nonFunction); ***REMOVED***,
			TypeError,
			debug(nonFunction) + ' is not a Function'
		);
	***REMOVED***);

	t.end();
***REMOVED***);

test('non-iterators', function (t) ***REMOVED***
	forEach([
		null,
		undefined,
		false,
		true,
		0,
		-0,
		NaN,
		42,
		Infinity,
		'',
		'abc',
		/a/g,
		[],
		***REMOVED******REMOVED***
	], function (nonIterator) ***REMOVED***
		t['throws'](
			function () ***REMOVED*** iterate(nonIterator); ***REMOVED***,
			TypeError,
			debug(nonIterator) + ' is not an iterator'
		);
	***REMOVED***);

	t.end();
***REMOVED***);
