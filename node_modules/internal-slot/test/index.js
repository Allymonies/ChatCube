'use strict';

var test = require('tape');
var inspect = require('object-inspect');
var forEach = require('foreach');

var SLOT = require('../');

test('assert', function (t) ***REMOVED***
	forEach([null, undefined, true, false, 'foo', '', 42, 0], function (primitive) ***REMOVED***
		t['throws'](
			function () ***REMOVED*** SLOT.assert(primitive, ''); ***REMOVED***,
			TypeError,
			inspect(primitive) + ' is not an Object'
		);
	***REMOVED***);

	forEach([null, undefined, true, false, 42, 0, ***REMOVED******REMOVED***, [], function () ***REMOVED******REMOVED***, /a/g], function (nonString) ***REMOVED***
		t['throws'](
			function () ***REMOVED*** SLOT.assert(***REMOVED******REMOVED***, nonString); ***REMOVED***,
			TypeError,
			inspect(nonString) + ' is not a String'
		);
	***REMOVED***);

	t['throws'](
		function () ***REMOVED*** SLOT.assert(***REMOVED******REMOVED***, 'whatever'); ***REMOVED***,
		TypeError,
		'nonexistent slot throws'
	);

	var o = ***REMOVED******REMOVED***;
	SLOT.set(o, 'x');
	t.doesNotThrow(function () ***REMOVED*** SLOT.assert(o, 'x'); ***REMOVED***, 'existent slot noops');

	t.end();
***REMOVED***);

test('has', function (t) ***REMOVED***
	forEach([null, undefined, true, false, 'foo', '', 42, 0], function (primitive) ***REMOVED***
		t['throws'](
			function () ***REMOVED*** SLOT.has(primitive, ''); ***REMOVED***,
			TypeError,
			inspect(primitive) + ' is not an Object'
		);
	***REMOVED***);

	forEach([null, undefined, true, false, 42, 0, ***REMOVED******REMOVED***, [], function () ***REMOVED******REMOVED***, /a/g], function (nonString) ***REMOVED***
		t['throws'](
			function () ***REMOVED*** SLOT.has(***REMOVED******REMOVED***, nonString); ***REMOVED***,
			TypeError,
			inspect(nonString) + ' is not a String'
		);
	***REMOVED***);

	var o = ***REMOVED******REMOVED***;

	t.equal(SLOT.has(o, 'nonexistent'), false, 'nonexistent slot yields false');

	SLOT.set(o, 'foo');
	t.equal(SLOT.has(o, 'foo'), true, 'existent slot yields true');

	t.end();
***REMOVED***);

test('get', function (t) ***REMOVED***
	forEach([null, undefined, true, false, 'foo', '', 42, 0], function (primitive) ***REMOVED***
		t['throws'](
			function () ***REMOVED*** SLOT.get(primitive, ''); ***REMOVED***,
			TypeError,
			inspect(primitive) + ' is not an Object'
		);
	***REMOVED***);

	forEach([null, undefined, true, false, 42, 0, ***REMOVED******REMOVED***, [], function () ***REMOVED******REMOVED***, /a/g], function (nonString) ***REMOVED***
		t['throws'](
			function () ***REMOVED*** SLOT.get(***REMOVED******REMOVED***, nonString); ***REMOVED***,
			TypeError,
			inspect(nonString) + ' is not a String'
		);
	***REMOVED***);

	var o = ***REMOVED******REMOVED***;
	t.equal(SLOT.get(o, 'nonexistent'), undefined, 'nonexistent slot is undefined');

	var v = ***REMOVED******REMOVED***;
	SLOT.set(o, 'f', v);
	t.equal(SLOT.get(o, 'f'), v, '"get" retrieves value set by "set"');

	t.end();
***REMOVED***);

test('set', function (t) ***REMOVED***
	forEach([null, undefined, true, false, 'foo', '', 42, 0], function (primitive) ***REMOVED***
		t['throws'](
			function () ***REMOVED*** SLOT.set(primitive, ''); ***REMOVED***,
			TypeError,
			inspect(primitive) + ' is not an Object'
		);
	***REMOVED***);

	forEach([null, undefined, true, false, 42, 0, ***REMOVED******REMOVED***, [], function () ***REMOVED******REMOVED***, /a/g], function (nonString) ***REMOVED***
		t['throws'](
			function () ***REMOVED*** SLOT.set(***REMOVED******REMOVED***, nonString); ***REMOVED***,
			TypeError,
			inspect(nonString) + ' is not a String'
		);
	***REMOVED***);

	var o = function () ***REMOVED******REMOVED***;
	t.equal(SLOT.get(o, 'f'), undefined, 'slot not set');

	SLOT.set(o, 'f', 42);
	t.equal(SLOT.get(o, 'f'), 42, 'slot was set');

	SLOT.set(o, 'f', Infinity);
	t.equal(SLOT.get(o, 'f'), Infinity, 'slot was set again');

	t.end();
***REMOVED***);
