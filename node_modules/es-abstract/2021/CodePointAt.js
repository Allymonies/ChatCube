'use strict';

var GetIntrinsic = require('get-intrinsic');

var $TypeError = GetIntrinsic('%TypeError%');
var callBound = require('call-bind/callBound');
var isLeadingSurrogate = require('../helpers/isLeadingSurrogate');
var isTrailingSurrogate = require('../helpers/isTrailingSurrogate');

var Type = require('./Type');
var UTF16SurrogatePairToCodePoint = require('./UTF16SurrogatePairToCodePoint');

var $charAt = callBound('String.prototype.charAt');
var $charCodeAt = callBound('String.prototype.charCodeAt');

// https://ecma-international.org/ecma-262/12.0/#sec-codepointat

module.exports = function CodePointAt(string, position) ***REMOVED***
	if (Type(string) !== 'String') ***REMOVED***
		throw new $TypeError('Assertion failed: `string` must be a String');
	***REMOVED***
	var size = string.length;
	if (position < 0 || position >= size) ***REMOVED***
		throw new $TypeError('Assertion failed: `position` must be >= 0, and < the length of `string`');
	***REMOVED***
	var first = $charCodeAt(string, position);
	var cp = $charAt(string, position);
	var firstIsLeading = isLeadingSurrogate(first);
	var firstIsTrailing = isTrailingSurrogate(first);
	if (!firstIsLeading && !firstIsTrailing) ***REMOVED***
		return ***REMOVED***
			'[[CodePoint]]': cp,
			'[[CodeUnitCount]]': 1,
			'[[IsUnpairedSurrogate]]': false
		***REMOVED***;
	***REMOVED***
	if (firstIsTrailing || (position + 1 === size)) ***REMOVED***
		return ***REMOVED***
			'[[CodePoint]]': cp,
			'[[CodeUnitCount]]': 1,
			'[[IsUnpairedSurrogate]]': true
		***REMOVED***;
	***REMOVED***
	var second = $charCodeAt(string, position + 1);
	if (!isTrailingSurrogate(second)) ***REMOVED***
		return ***REMOVED***
			'[[CodePoint]]': cp,
			'[[CodeUnitCount]]': 1,
			'[[IsUnpairedSurrogate]]': true
		***REMOVED***;
	***REMOVED***

	return ***REMOVED***
		'[[CodePoint]]': UTF16SurrogatePairToCodePoint(first, second),
		'[[CodeUnitCount]]': 2,
		'[[IsUnpairedSurrogate]]': false
	***REMOVED***;
***REMOVED***;
