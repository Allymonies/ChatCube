'use strict';

var GetIntrinsic = require('get-intrinsic');

var $TypeError = GetIntrinsic('%TypeError%');

var MAX_SAFE_INTEGER = require('../helpers/maxSafeInteger');

var Call = require('./Call');
var CreateDataPropertyOrThrow = require('./CreateDataPropertyOrThrow');
var Get = require('./Get');
var HasProperty = require('./HasProperty');
var IsArray = require('./IsArray');
var LengthOfArrayLike = require('./LengthOfArrayLike');
var ToString = require('./ToString');

// https://262.ecma-international.org/11.0/#sec-flattenintoarray

// eslint-disable-next-line max-params
module.exports = function FlattenIntoArray(target, source, sourceLen, start, depth) ***REMOVED***
	var mapperFunction;
	if (arguments.length > 5) ***REMOVED***
		mapperFunction = arguments[5];
	***REMOVED***

	var targetIndex = start;
	var sourceIndex = 0;
	while (sourceIndex < sourceLen) ***REMOVED***
		var P = ToString(sourceIndex);
		var exists = HasProperty(source, P);
		if (exists === true) ***REMOVED***
			var element = Get(source, P);
			if (typeof mapperFunction !== 'undefined') ***REMOVED***
				if (arguments.length <= 6) ***REMOVED***
					throw new $TypeError('Assertion failed: thisArg is required when mapperFunction is provided');
				***REMOVED***
				element = Call(mapperFunction, arguments[6], [element, sourceIndex, source]);
			***REMOVED***
			var shouldFlatten = false;
			if (depth > 0) ***REMOVED***
				shouldFlatten = IsArray(element);
			***REMOVED***
			if (shouldFlatten) ***REMOVED***
				var elementLen = LengthOfArrayLike(element);
				targetIndex = FlattenIntoArray(target, element, elementLen, targetIndex, depth - 1);
			***REMOVED*** else ***REMOVED***
				if (targetIndex >= MAX_SAFE_INTEGER) ***REMOVED***
					throw new $TypeError('index too large');
				***REMOVED***
				CreateDataPropertyOrThrow(target, ToString(targetIndex), element);
				targetIndex += 1;
			***REMOVED***
		***REMOVED***
		sourceIndex += 1;
	***REMOVED***

	return targetIndex;
***REMOVED***;
