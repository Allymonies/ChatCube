'use strict';

var test = require('tape');
var toPrimitive = require('../es2015');
var is = require('object-is');
var forEach = require('foreach');
var functionName = require('function.prototype.name');
var debug = require('object-inspect');

var hasSymbols = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol';
var hasSymbolToPrimitive = hasSymbols && typeof Symbol.toPrimitive === 'symbol';

test('function properties', function (t) ***REMOVED***
	t.equal(toPrimitive.length, 1, 'length is 1');
	t.equal(functionName(toPrimitive), 'ToPrimitive', 'name is ToPrimitive');

	t.end();
***REMOVED***);

var primitives = [null, undefined, true, false, 0, -0, 42, NaN, Infinity, -Infinity, '', 'abc'];

test('primitives', function (t) ***REMOVED***
	forEach(primitives, function (i) ***REMOVED***
		t.ok(is(toPrimitive(i), i), 'toPrimitive(' + debug(i) + ') returns the same value');
		t.ok(is(toPrimitive(i, String), i), 'toPrimitive(' + debug(i) + ', String) returns the same value');
		t.ok(is(toPrimitive(i, Number), i), 'toPrimitive(' + debug(i) + ', Number) returns the same value');
	***REMOVED***);
	t.end();
***REMOVED***);

test('Symbols', ***REMOVED*** skip: !hasSymbols ***REMOVED***, function (t) ***REMOVED***
	var symbols = [
		Symbol('foo'),
		Symbol.iterator,
		Symbol['for']('foo') // eslint-disable-line no-restricted-properties
	];
	forEach(symbols, function (sym) ***REMOVED***
		t.equal(toPrimitive(sym), sym, 'toPrimitive(' + debug(sym) + ') returns the same value');
		t.equal(toPrimitive(sym, String), sym, 'toPrimitive(' + debug(sym) + ', String) returns the same value');
		t.equal(toPrimitive(sym, Number), sym, 'toPrimitive(' + debug(sym) + ', Number) returns the same value');
	***REMOVED***);

	var primitiveSym = Symbol('primitiveSym');
	var objectSym = Object(primitiveSym);
	t.equal(toPrimitive(objectSym), primitiveSym, 'toPrimitive(' + debug(objectSym) + ') returns ' + debug(primitiveSym));
	t.equal(toPrimitive(objectSym, String), primitiveSym, 'toPrimitive(' + debug(objectSym) + ', String) returns ' + debug(primitiveSym));
	t.equal(toPrimitive(objectSym, Number), primitiveSym, 'toPrimitive(' + debug(objectSym) + ', Number) returns ' + debug(primitiveSym));
	t.end();
***REMOVED***);

test('Arrays', function (t) ***REMOVED***
	var arrays = [[], ['a', 'b'], [1, 2]];
	forEach(arrays, function (arr) ***REMOVED***
		t.equal(toPrimitive(arr), String(arr), 'toPrimitive(' + debug(arr) + ') returns the string version of the array');
		t.equal(toPrimitive(arr, String), String(arr), 'toPrimitive(' + debug(arr) + ') returns the string version of the array');
		t.equal(toPrimitive(arr, Number), String(arr), 'toPrimitive(' + debug(arr) + ') returns the string version of the array');
	***REMOVED***);
	t.end();
***REMOVED***);

test('Dates', function (t) ***REMOVED***
	var dates = [new Date(), new Date(0), new Date(NaN)];
	forEach(dates, function (date) ***REMOVED***
		t.equal(toPrimitive(date), String(date), 'toPrimitive(' + debug(date) + ') returns the string version of the date');
		t.equal(toPrimitive(date, String), String(date), 'toPrimitive(' + debug(date) + ') returns the string version of the date');
		t.ok(is(toPrimitive(date, Number), Number(date)), 'toPrimitive(' + debug(date) + ') returns the number version of the date');
	***REMOVED***);
	t.end();
***REMOVED***);

var coercibleObject = ***REMOVED*** valueOf: function () ***REMOVED*** return 3; ***REMOVED***, toString: function () ***REMOVED*** return 42; ***REMOVED*** ***REMOVED***;
var valueOfOnlyObject = ***REMOVED*** valueOf: function () ***REMOVED*** return 4; ***REMOVED***, toString: function () ***REMOVED*** return ***REMOVED******REMOVED***; ***REMOVED*** ***REMOVED***;
var toStringOnlyObject = ***REMOVED*** valueOf: function () ***REMOVED*** return ***REMOVED******REMOVED***; ***REMOVED***, toString: function () ***REMOVED*** return 7; ***REMOVED*** ***REMOVED***;
var coercibleFnObject = ***REMOVED***
	valueOf: function () ***REMOVED*** return function valueOfFn() ***REMOVED******REMOVED***; ***REMOVED***,
	toString: function () ***REMOVED*** return 42; ***REMOVED***
***REMOVED***;
var uncoercibleObject = ***REMOVED*** valueOf: function () ***REMOVED*** return ***REMOVED******REMOVED***; ***REMOVED***, toString: function () ***REMOVED*** return ***REMOVED******REMOVED***; ***REMOVED*** ***REMOVED***;
var uncoercibleFnObject = ***REMOVED***
	valueOf: function () ***REMOVED*** return function valueOfFn() ***REMOVED******REMOVED***; ***REMOVED***,
	toString: function () ***REMOVED*** return function toStrFn() ***REMOVED******REMOVED***; ***REMOVED***
***REMOVED***;

test('Objects', function (t) ***REMOVED***
	t.equal(toPrimitive(coercibleObject), coercibleObject.valueOf(), 'coercibleObject with no hint coerces to valueOf');
	t.equal(toPrimitive(coercibleObject, Number), coercibleObject.valueOf(), 'coercibleObject with hint Number coerces to valueOf');
	t.equal(toPrimitive(coercibleObject, String), coercibleObject.toString(), 'coercibleObject with hint String coerces to non-stringified toString');

	t.equal(toPrimitive(coercibleFnObject), coercibleFnObject.toString(), 'coercibleFnObject coerces to non-stringified toString');
	t.equal(toPrimitive(coercibleFnObject, Number), coercibleFnObject.toString(), 'coercibleFnObject with hint Number coerces to non-stringified toString');
	t.equal(toPrimitive(coercibleFnObject, String), coercibleFnObject.toString(), 'coercibleFnObject with hint String coerces to non-stringified toString');

	t.equal(toPrimitive(***REMOVED******REMOVED***), '[object Object]', '***REMOVED******REMOVED*** with no hint coerces to Object#toString');
	t.equal(toPrimitive(***REMOVED******REMOVED***, Number), '[object Object]', '***REMOVED******REMOVED*** with hint Number coerces to Object#toString');
	t.equal(toPrimitive(***REMOVED******REMOVED***, String), '[object Object]', '***REMOVED******REMOVED*** with hint String coerces to Object#toString');

	t.equal(toPrimitive(toStringOnlyObject), toStringOnlyObject.toString(), 'toStringOnlyObject returns non-stringified toString');
	t.equal(toPrimitive(toStringOnlyObject, Number), toStringOnlyObject.toString(), 'toStringOnlyObject with hint Number returns non-stringified toString');
	t.equal(toPrimitive(toStringOnlyObject, String), toStringOnlyObject.toString(), 'toStringOnlyObject with hint String returns non-stringified toString');

	t.equal(toPrimitive(valueOfOnlyObject), valueOfOnlyObject.valueOf(), 'valueOfOnlyObject returns valueOf');
	t.equal(toPrimitive(valueOfOnlyObject, Number), valueOfOnlyObject.valueOf(), 'valueOfOnlyObject with hint Number returns valueOf');
	t.equal(toPrimitive(valueOfOnlyObject, String), valueOfOnlyObject.valueOf(), 'valueOfOnlyObject with hint String returns non-stringified valueOf');

	t.test('Symbol.toPrimitive', ***REMOVED*** skip: !hasSymbolToPrimitive ***REMOVED***, function (st) ***REMOVED***
		var overriddenObject = ***REMOVED*** toString: st.fail, valueOf: st.fail ***REMOVED***;
		overriddenObject[Symbol.toPrimitive] = function (hint) ***REMOVED*** return String(hint); ***REMOVED***;

		st.equal(toPrimitive(overriddenObject), 'default', 'object with Symbol.toPrimitive + no hint invokes that');
		st.equal(toPrimitive(overriddenObject, Number), 'number', 'object with Symbol.toPrimitive + hint Number invokes that');
		st.equal(toPrimitive(overriddenObject, String), 'string', 'object with Symbol.toPrimitive + hint String invokes that');

		var nullToPrimitive = ***REMOVED*** toString: coercibleObject.toString, valueOf: coercibleObject.valueOf ***REMOVED***;
		nullToPrimitive[Symbol.toPrimitive] = null;
		st.equal(toPrimitive(nullToPrimitive), toPrimitive(coercibleObject), 'object with no hint + null Symbol.toPrimitive ignores it');
		st.equal(toPrimitive(nullToPrimitive, Number), toPrimitive(coercibleObject, Number), 'object with hint Number + null Symbol.toPrimitive ignores it');
		st.equal(toPrimitive(nullToPrimitive, String), toPrimitive(coercibleObject, String), 'object with hint String + null Symbol.toPrimitive ignores it');

		st.test('exceptions', function (sst) ***REMOVED***
			var nonFunctionToPrimitive = ***REMOVED*** toString: sst.fail, valueOf: sst.fail ***REMOVED***;
			nonFunctionToPrimitive[Symbol.toPrimitive] = ***REMOVED******REMOVED***;
			sst['throws'](toPrimitive.bind(null, nonFunctionToPrimitive), TypeError, 'Symbol.toPrimitive returning a non-function throws');

			var uncoercibleToPrimitive = ***REMOVED*** toString: sst.fail, valueOf: sst.fail ***REMOVED***;
			uncoercibleToPrimitive[Symbol.toPrimitive] = function (hint) ***REMOVED***
				return ***REMOVED*** toString: function () ***REMOVED*** return hint; ***REMOVED*** ***REMOVED***;
			***REMOVED***;
			sst['throws'](toPrimitive.bind(null, uncoercibleToPrimitive), TypeError, 'Symbol.toPrimitive returning an object throws');

			var throwingToPrimitive = ***REMOVED*** toString: sst.fail, valueOf: sst.fail ***REMOVED***;
			throwingToPrimitive[Symbol.toPrimitive] = function (hint) ***REMOVED*** throw new RangeError(hint); ***REMOVED***;
			sst['throws'](toPrimitive.bind(null, throwingToPrimitive), RangeError, 'Symbol.toPrimitive throwing throws');

			sst.end();
		***REMOVED***);

		st.end();
	***REMOVED***);

	t.test('exceptions', function (st) ***REMOVED***
		st['throws'](toPrimitive.bind(null, uncoercibleObject), TypeError, 'uncoercibleObject throws a TypeError');
		st['throws'](toPrimitive.bind(null, uncoercibleObject, Number), TypeError, 'uncoercibleObject with hint Number throws a TypeError');
		st['throws'](toPrimitive.bind(null, uncoercibleObject, String), TypeError, 'uncoercibleObject with hint String throws a TypeError');

		st['throws'](toPrimitive.bind(null, uncoercibleFnObject), TypeError, 'uncoercibleFnObject throws a TypeError');
		st['throws'](toPrimitive.bind(null, uncoercibleFnObject, Number), TypeError, 'uncoercibleFnObject with hint Number throws a TypeError');
		st['throws'](toPrimitive.bind(null, uncoercibleFnObject, String), TypeError, 'uncoercibleFnObject with hint String throws a TypeError');
		st.end();
	***REMOVED***);
	t.end();
***REMOVED***);
