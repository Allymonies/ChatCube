'use strict';

var implementation = require('./implementation');

var lacksProperEnumerationOrder = function () ***REMOVED***
	if (!Object.assign) ***REMOVED***
		return false;
	***REMOVED***
	/*
	 * v8, specifically in node 4.x, has a bug with incorrect property enumeration order
	 * note: this does not detect the bug unless there's 20 characters
	 */
	var str = 'abcdefghijklmnopqrst';
	var letters = str.split('');
	var map = ***REMOVED******REMOVED***;
	for (var i = 0; i < letters.length; ++i) ***REMOVED***
		map[letters[i]] = letters[i];
	***REMOVED***
	var obj = Object.assign(***REMOVED******REMOVED***, map);
	var actual = '';
	for (var k in obj) ***REMOVED***
		actual += k;
	***REMOVED***
	return str !== actual;
***REMOVED***;

var assignHasPendingExceptions = function () ***REMOVED***
	if (!Object.assign || !Object.preventExtensions) ***REMOVED***
		return false;
	***REMOVED***
	/*
	 * Firefox 37 still has "pending exception" logic in its Object.assign implementation,
	 * which is 72% slower than our shim, and Firefox 40's native implementation.
	 */
	var thrower = Object.preventExtensions(***REMOVED*** 1: 2 ***REMOVED***);
	try ***REMOVED***
		Object.assign(thrower, 'xy');
	***REMOVED*** catch (e) ***REMOVED***
		return thrower[1] === 'y';
	***REMOVED***
	return false;
***REMOVED***;

module.exports = function getPolyfill() ***REMOVED***
	if (!Object.assign) ***REMOVED***
		return implementation;
	***REMOVED***
	if (lacksProperEnumerationOrder()) ***REMOVED***
		return implementation;
	***REMOVED***
	if (assignHasPendingExceptions()) ***REMOVED***
		return implementation;
	***REMOVED***
	return Object.assign;
***REMOVED***;
